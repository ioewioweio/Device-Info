<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Информация о вас</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', Arial, sans-serif;
            display: flex;
            flex-direction: column; /* Изменено на столбец */
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #e9ecef; /* Более мягкий фон */
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            line-height: 1.6;
        }
        .header {
            width: 100%;
            max-width: 900px;
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: #343a40;
            font-size: 2.8em; /* Более крупный заголовок */
            margin-bottom: 10px;
        }
        .header p {
            color: #6c757d;
            font-size: 1.1em;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); /* Адаптивная сетка */
            gap: 25px; /* Увеличенный отступ между карточками */
            max-width: 900px;
            width: 100%;
        }
        .info-card {
            background-color: #ffffff;
            padding: 25px;
            border-radius: 12px; /* Более скругленные углы */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1); /* Более выраженная тень */
            text-align: center;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            cursor: pointer; /* Добавлено для индикации кликабельности */
            position: relative; /* Для позиционирования сообщения о копировании */
            overflow: hidden; /* Чтобы текст не выходил за границы при копировании */
        }
        .info-card:hover {
            transform: translateY(-5px); /* Легкий эффект при наведении */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        .info-card h2 {
            color: #495057;
            font-size: 1.5em; /* Заголовки в карточках */
            margin-bottom: 15px;
            border-bottom: 2px solid #e9ecef; /* Разделитель */
            padding-bottom: 10px;
        }
        .info-value {
            font-size: 1.6em; /* Крупные значения */
            color: #007bff;
            font-weight: 700; /* Жирный шрифт */
            display: block;
            margin-top: 10px;
            word-wrap: break-word;
        }
        .loading {
            color: #888;
            font-size: 1.2em;
        }
        .warning {
            color: #ffc107; /* Желтый для предупреждений */
            font-weight: 400;
        }
        .error {
            color: #dc3545; /* Красный для ошибок */
            font-weight: 400;
        }
        .note {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 10px;
        }
        .copied-message {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 123, 255, 0.9); /* Полупрозрачный синий фон */
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.8em;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            border-radius: 12px;
            pointer-events: none; /* Чтобы не блокировал клики на карточку */
        }
        .copied-message.show {
            opacity: 1;
        }

        /* Адаптация для мобильных устройств */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            .info-grid {
                grid-template-columns: 1fr; /* Одна колонка на мобильных */
                gap: 20px;
            }
            .info-card {
                padding: 20px;
            }
            .info-card h2 {
                font-size: 1.3em;
            }
            .info-value {
                font-size: 1.4em;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Ваша цифровая подпись в сети</h1>
        <p>Узнайте подробнее, какую информацию ваш браузер и устройство могут раскрывать в интернете.</p>
    </div>

    <div class="info-grid">

        <div class="info-card" data-copy-target="ipv4-address">
            <h2>Ваш IP-адрес (IPv4)</h2>
            <span id="ipv4-address" class="info-value loading">Загрузка...</span>
            <div class="copied-message">Скопировано!</div>
        </div>

        <div class="info-card" data-copy-target="ipv6-address">
            <h2>Ваш IP-адрес (IPv6)</h2>
            <span id="ipv6-address" class="info-value loading">Загрузка...</span>
            <p class="note">Отображает ваш IPv6-адрес, если доступен. Если IPv6-соединение отсутствует, может быть показан ваш IPv4-адрес, используемый для IPv6-сервисов.</p>
            <div class="copied-message">Скопировано!</div>
        </div>

        <div class="info-card" data-copy-target="location-info">
            <h2>Страна и Город</h2>
            <span id="location-info" class="info-value loading">Загрузка...</span>
            <div class="copied-message">Скопировано!</div>
        </div>

        <div class="info-card" data-copy-target="dns-info">
            <h2>DNS</h2>
            <span id="dns-info" class="info-value warning">Недоступно с клиента.</span>
            <p class="note">Определение DNS-сервера невозможно напрямую из браузера из соображений безопасности.</p>
            <div class="copied-message">Скопировано!</div>
        </div>

        <div class="info-card" data-copy-target="webrtc-support">
            <h2>Поддержка WebRTC</h2>
            <span id="webrtc-support" class="info-value loading">Проверка...</span>
            <div class="copied-message">Скопировано!</div>
        </div>

        <div class="info-card" data-copy-target="webrtc-leak">
            <h2>Обнаруженные WebRTC IP</h2>
            <span id="webrtc-leak" class="info-value loading">Проверка...</span>
            <p class="note">Может показывать локальные IP или реальный IP при использовании VPN.</p>
            <div class="copied-message">Скопировано!</div>
        </div>

        <div class="info-card" data-copy-target="user-agent">
            <h2>User-Agent</h2>
            <span id="user-agent" class="info-value loading">Загрузка...</span>
            <div class="copied-message">Скопировано!</div>
        </div>

        <div class="info-card" data-copy-target="browser-info">
            <h2>Браузер</h2>
            <span id="browser-info" class="info-value loading">Загрузка...</span>
            <div class="copied-message">Скопировано!</div>
        </div>

        <div class="info-card" data-copy-target="os-info">
            <h2>Операционная система</h2>
            <span id="os-info" class="info-value loading">Загрузка...</span>
            <div class="copied-message">Скопировано!</div>
        </div>

        <div class="info-card" data-copy-target="battery-info">
            <h2>Батарея</h2>
            <span id="battery-info" class="info-value loading">Загрузка...</span>
            <p class="note">Может быть недоступно (например, в Firefox или без HTTPS).</p>
            <div class="copied-message">Скопировано!</div>
        </div>

        <div class="info-card" data-copy-target="screen-resolution">
            <h2>Разрешение экрана</h2>
            <span id="screen-resolution" class="info-value loading">Загрузка...</span>
            <div class="copied-message">Скопировано!</div>
        </div>

        <div class="info-card" data-copy-target="device-time">
            <h2>Время устройства</h2>
            <span id="device-time" class="info-value loading">Загрузка...</span>
            <div class="copied-message">Скопировано!</div>
        </div>

        <div class="info-card" data-copy-target="device-language">
            <h2>Язык устройства</h2>
            <span id="device-language" class="info-value loading">Загрузка...</span>
            <div class="copied-message">Скопировано!</div>
        </div>

        <div class="info-card" data-copy-target="browser-language">
            <h2>Язык браузера</h2>
            <span id="browser-language" class="info-value loading">Загрузка...</span>
            <div class="copied-message">Скопировано!</div>
        </div>

    </div>

    <script>
        // Функция для проверки, является ли строка действительным IP-адресом
        function isValidIpAddress(ip) {
            // Проверка на IPv4
            if (/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(ip)) {
                return true;
            }
            // Проверка на IPv6 (более сложная, но базовая)
            // Это регулярное выражение более надежно, чем предыдущее
            if (/^(([0-9a-fA-F]{1,4}:){7}([0-9a-fA-F]{1,4}|:))|(([0-9a-fA-F]{1,4}:){6}(:[0-9a-fA-F]{1,4}|((25[0-5]|2[0-4]\d|1?\d?\d)\.){3}(25[0-5]|2[0-4]\d|1?\d?\d)))|(([0-9a-fA-F]{1,4}:){5}(((:[0-9a-fA-F]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1?\d?\d)\.){3}(25[0-5]|2[0-4]\d|1?\d?\d)))|(([0-9a-fA-F]{1,4}:){4}(((:[0-9a-fA-F]{1,4}){1,3})|((:[0-9a-fA-F]{1,4})?:((25[0-5]|2[0-4]\d|1?\d?\d)\.){3}(25[0-5]|2[0-4]\d|1?\d?\d))))|(([0-9a-fA-F]{1,4}:){3}(((:[0-9a-fA-F]{1,4}){1,4})|((:[0-9a-fA-F]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1?\d?\d)\.){3}(25[0-5]|2[0-4]\d|1?\d?\d))))|(([0-9a-fA-F]{1,4}:){2}(((:[0-9a-fA-F]{1,4}){1,5})|((:[0-9a-fA-F]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1?\d?\d)\.){3}(25[0-5]|2[0-4]\d|1?\d?\d))))|(([0-9a-fA-F]{1,4}:){1}(((:[0-9a-fA-F]{1,4}){1,6})|((:[0-9a-fA-F]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1?\d?\d)\.){3}(25[0-5]|2[0-4]\d|1?\d?\d))))|(::((([0-9a-fA-F]{1,4}:){1,7})|((:[0-9a-fA-F]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1?\d?\d)\.){3}(25[0-5]|2[0-4]\d|1?\d?\d))))$/.test(ip)) {
                return true;
            }
            return false;
        }

        // --- IP-адреса и местоположение ---
        async function getIpAndLocation() {
            const ipv4AddressElement = document.getElementById('ipv4-address');
            const ipv6AddressElement = document.getElementById('ipv6-address');
            const locationInfoElement = document.getElementById('location-info');

            try {
                // Попытка получить IPv4 и местоположение через ip-api.com
                const ipv4Response = await fetch('https://ip-api.com/json');
                const ipv4Data = await ipv4Response.json();

                if (ipv4Data.status === 'success') {
                    ipv4AddressElement.textContent = ipv4Data.query;
                    locationInfoElement.textContent = `${ipv4Data.country}, ${ipv4Data.city}`;
                } else {
                    // Фолбэк: если ip-api.com не сработал, попробуем ipify.org для IPv4
                    console.warn('ip-api.com не ответил, используем фолбэк для IPv4.');
                    try {
                        const fallbackIpv4Response = await fetch('https://api.ipify.org?format=json');
                        const fallbackIpv4Data = await fallbackIpv4Response.json();
                        if (fallbackIpv4Data.ip) {
                            ipv4AddressElement.textContent = fallbackIpv4Data.ip;
                            locationInfoElement.textContent = 'Местоположение неизвестно (API-ошибка).';
                        } else {
                            ipv4AddressElement.textContent = 'Не удалось получить IPv4 (API-ошибка).';
                            locationInfoElement.textContent = 'Не удалось получить местоположение (API-ошибка).';
                        }
                    } catch (fallbackError) {
                        console.error('Ошибка фолбэк API для IPv4:', fallbackError);
                        ipv4AddressElement.textContent = 'Ошибка сети при получении IPv4.';
                        locationInfoElement.textContent = 'Ошибка сети при получении местоположения.';
                    }
                }

                // Получение IPv6 через api64.ipify.org
                const ipv6Response = await fetch('https://api64.ipify.org?format=json');
                const ipv6Data = await ipv6Response.json();
                if (ipv6Data.ip) {
                    ipv6AddressElement.textContent = ipv6Data.ip;
                } else {
                    ipv6AddressElement.textContent = 'IPv6 не обнаружен или API недоступен.';
                }

            } catch (overallError) {
                console.error('Общая ошибка при получении IP/местоположения:', overallError);
                // Устанавливаем статус ошибки, если что-то пошло не так на первом этапе
                ipv4AddressElement.textContent = 'Ошибка сети при получении IPv4.';
                locationInfoElement.textContent = 'Ошибка сети при получении местоположения.';
                ipv6AddressElement.textContent = 'Ошибка сети при получении IPv6.';

                ipv4AddressElement.classList.add('error');
                locationInfoElement.classList.add('error');
                ipv6AddressElement.classList.add('error');
            } finally {
                ipv4AddressElement.classList.remove('loading');
                ipv6AddressElement.classList.remove('loading');
                locationInfoElement.classList.remove('loading');
            }
        }

        // --- DNS (клиенту недоступно) ---
        function getDnsInfo() {
            document.getElementById('dns-info').classList.remove('loading');
        }

        // --- WebRTC ---
        async function getWebRTCInfo() {
            const webrtcSupportElement = document.getElementById('webrtc-support');
            const webrtcLeakElement = document.getElementById('webrtc-leak');

            if (typeof RTCPeerConnection === 'undefined') {
                webrtcSupportElement.textContent = 'WebRTC не поддерживается.';
                webrtcSupportElement.classList.add('error');
                webrtcLeakElement.textContent = 'N/A';
                webrtcLeakElement.classList.add('error');
                webrtcSupportElement.classList.remove('loading');
                webrtcLeakElement.classList.remove('loading');
                return;
            }

            webrtcSupportElement.textContent = 'Поддерживается.';
            webrtcSupportElement.classList.remove('loading');

            try {
                const pc = new RTCPeerConnection({ iceServers: [] });
                const candidates = [];

                pc.onicecandidate = function(event) {
                    if (event.candidate) {
                        const candidateString = event.candidate.candidate;
                        const parts = candidateString.split(' ');
                        const ipAddress = parts[4];
                        const candidateType = parts[7];

                        if (candidateType === 'host' && isValidIpAddress(ipAddress)) {
                            if (!candidates.includes(ipAddress)) {
                                candidates.push(ipAddress);
                            }
                        }
                    } else {
                        const ipList = candidates.length > 0 ? candidates.join(', ') : 'Не обнаружено (или заблокировано).';
                        webrtcLeakElement.textContent = ipList;
                        webrtcLeakElement.classList.remove('loading');
                        if (candidates.length > 0 && ipList !== 'Не обнаружено (или заблокировано).') {
                             webrtcLeakElement.classList.add('warning');
                        }
                    }
                };

                pc.createDataChannel('');
                await pc.createOffer().then(offer => pc.setLocalDescription(offer));

            } catch (error) {
                console.error('Ошибка WebRTC утечки:', error);
                webrtcLeakElement.textContent = 'Ошибка при проверке WebRTC утечки.';
                webrtcLeakElement.classList.add('error');
                webrtcLeakElement.classList.remove('loading');
            }
        }

        // --- User-Agent ---
        function getUserAgent() {
            const userAgentElement = document.getElementById('user-agent');
            userAgentElement.textContent = navigator.userAgent;
            userAgentElement.classList.remove('loading');
        }

        // --- Браузер и ОС ---
        // Учитывая, что используем Chromium, navigator.userAgentData будет приоритетным.
        // Оставим старый метод как запасной, хотя он и не будет часто использоваться.
        async function getBrowserAndOSInfo() {
            const browserInfoElement = document.getElementById('browser-info');
            const osInfoElement = document.getElementById('os-info');
            let browserName = "Неизвестен";
            let browserVersion = "Неизвестна";
            let osName = "Неизвестна";
            let osVersion = "";

            if (navigator.userAgentData) { // User-Agent Client Hints
                try {
                    const uaData = await navigator.userAgentData.getHighEntropyValues(["fullVersionList", "platform", "platformVersion"]);
                    const brands = uaData.fullVersionList || uaData.brands;

                    if (brands && brands.length > 0) {
                        for (const brand of brands) {
                            if (!brand.brand.includes("Not")) { // Отфильтровываем "Not A;Brand"
                                browserName = brand.brand;
                                browserVersion = brand.version;
                                break;
                            }
                        }
                    }

                    osName = uaData.platform || "Неизвестна";
                    osVersion = uaData.platformVersion ? ` ${uaData.platformVersion}` : "";

                } catch (error) {
                    console.error('Ошибка Client Hints:', error);
                    // В случае ошибки с Client Hints, используем старый метод
                    getBrowserAndOSInfoLegacy(browserInfoElement, osInfoElement);
                }
            } else { // Fallback для старых версий или других браузеров
                getBrowserAndOSInfoLegacy(browserInfoElement, osInfoElement);
            }

            browserInfoElement.textContent = `${browserName} (Версия: ${browserVersion})`;
            osInfoElement.textContent = `${osName}${osVersion}`;
            browserInfoElement.classList.remove('loading');
            osInfoElement.classList.remove('loading');
        }

        function getBrowserAndOSInfoLegacy(browserElement, osElement) {
            const userAgent = navigator.userAgent;
            let browserName = "Неизвестен (по User-Agent)";
            let browserVersion = "Неизвестна";
            let osName = "Неизвестна (по User-Agent)";
            let osVersion = "";

            // Browser detection (legacy)
            if (userAgent.includes("Chrome") && !userAgent.includes("Edg") && !userAgent.includes("Opr")) {
                browserName = "Google Chrome";
                browserVersion = userAgent.match(/Chrome\/([0-9.]+)/)?.[1] || "Неизвестна";
            } else if (userAgent.includes("Edg")) {
                browserName = "Microsoft Edge";
                browserVersion = userAgent.match(/Edg\/([0-9.]+)/)?.[1] || "Неизвестна";
            } else if (userAgent.includes("Opera") || userAgent.includes("Opr")) {
                browserName = "Opera";
                browserVersion = userAgent.match(/(Opera|Opr)\/([0-9.]+)/)?.[2] || "Неизвестна";
            } else if (userAgent.includes("Safari")) { // Safari часто содержит "Chrome" в UA, поэтому проверяем после Chrome
                browserName = "Apple Safari";
                browserVersion = userAgent.match(/Version\/([0-9.]+).*Safari/)?.[1] || "Неизвестна";
            } else if (userAgent.includes("Firefox")) {
                browserName = "Mozilla Firefox";
                browserVersion = userAgent.match(/Firefox\/([0-9.]+)/)?.[1] || "Неизвестна";
            } else if (userAgent.includes("MSIE") || userAgent.includes("Trident")) {
                browserName = "Internet Explorer";
                browserVersion = userAgent.match(/(MSIE |rv:)([0-9.]+)/)?.[2] || "Неизвестна";
            }

            // OS detection (legacy) - упрощено, но остается для общей совместимости
            if (userAgent.includes("Windows NT 10.0")) { osName = "Windows"; osVersion = "10/11"; }
            else if (userAgent.includes("Windows NT 6.3")) { osName = "Windows"; osVersion = "8.1"; }
            else if (userAgent.includes("Windows NT 6.2")) { osName = "Windows"; osVersion = "8"; }
            else if (userAgent.includes("Windows NT 6.1")) { osName = "Windows"; osVersion = "7"; }
            else if (userAgent.includes("Android")) { osName = "Android"; osVersion = userAgent.match(/Android ([0-9.]+)/)?.[1] || ""; }
            else if (userAgent.includes("Mac OS X")) { osName = "macOS"; osVersion = userAgent.match(/Mac OS X ([0-9_.]+)/)?.[1]?.replace(/_/g, '.') || ""; }
            else if (userAgent.includes("Linux")) { osName = "Linux"; }
            else if (userAgent.includes("iOS")) { osName = "iOS"; osVersion = userAgent.match(/OS ([0-9_.]+)/)?.[1]?.replace(/_/g, '.') || ""; }
            // Общие fallback'и
            else if (navigator.platform.includes("Win")) { osName = "Windows"; }
            else if (navigator.platform.includes("Mac")) { osName = "macOS"; }
            else if (navigator.platform.includes("Linux")) { osName = "Linux"; }
            else if (navigator.platform.includes("iPhone") || navigator.platform.includes("iPad") || navigator.platform.includes("iPod")) { osName = "iOS"; }


            browserElement.textContent = `${browserName}${browserVersion !== "Неизвестна" ? ` (Версия: ${browserVersion})` : ""}`;
            osElement.textContent = `${osName}${osVersion ? ' ' + osVersion : ''}`;
        }

        // --- Батарея ---
        async function getBatteryInfo() {
            const batteryInfoElement = document.getElementById('battery-info');
            if ('getBattery' in navigator) {
                try {
                    const battery = await navigator.getBattery();
                    const level = (battery.level * 100).toFixed(0);
                    const charging = battery.charging ? ' (Заряжается)' : ' (Не заряжается)';
                    batteryInfoElement.textContent = `${level}%${charging}`;
                } catch (error) {
                    console.error('Ошибка при получении информации о батарее:', error);
                    batteryInfoElement.textContent = 'Ошибка получения батареи.';
                    batteryInfoElement.classList.add('error');
                }
            } else {
                batteryInfoElement.textContent = 'API Батареи недоступен.';
                batteryInfoElement.classList.add('warning');
            }
            batteryInfoElement.classList.remove('loading');
        }

        // --- Разрешение экрана ---
        function getScreenResolution() {
            const screenResolutionElement = document.getElementById('screen-resolution');
            screenResolutionElement.textContent = `${screen.width}x${screen.height} пикселей`;
            screenResolutionElement.classList.remove('loading');
        }

        // --- Время и язык устройства/браузера ---
        function updateDeviceTimeAndLanguage() {
            const deviceTimeElement = document.getElementById('device-time');
            const deviceLanguageElement = document.getElementById('device-language');
            const browserLanguageElement = document.getElementById('browser-language');

            const now = new Date();
            deviceTimeElement.textContent = now.toLocaleString();
            deviceTimeElement.classList.remove('loading');

            deviceLanguageElement.textContent = (navigator.languages && navigator.languages.length > 0) ? navigator.languages.join(', ') : 'Неизвестен';
            deviceLanguageElement.classList.remove('loading');

            browserLanguageElement.textContent = navigator.language || 'Неизвестен';
            browserLanguageElement.classList.remove('loading');
        }

        // --- Функция копирования ---
        async function copyCardInfo(event) {
            const card = event.currentTarget;
            const titleElement = card.querySelector('h2');
            const valueElement = card.querySelector('.info-value');
            const copiedMessage = card.querySelector('.copied-message');

            if (!titleElement || !valueElement || !copiedMessage) {
                console.error("Не удалось найти элементы для копирования в карточке.");
                return;
            }

            const title = titleElement.textContent.trim();
            const value = valueElement.textContent.trim();
            const textToCopy = `${title}: ${value}`;

            try {
                await navigator.clipboard.writeText(textToCopy);

                // Показываем сообщение "Скопировано!"
                copiedMessage.classList.add('show');
                setTimeout(() => {
                    copiedMessage.classList.remove('show');
                }, 1000);

            } catch (err) {
                console.error('Не удалось скопировать текст: ', err);
                alert('Не удалось скопировать текст. Возможно, браузер не поддерживает или не дал разрешение.');
            }
        }


        // --- Вызов всех функций ---
        document.addEventListener('DOMContentLoaded', () => {
            getIpAndLocation();
            getDnsInfo(); // По-прежнему не изменится
            getWebRTCInfo();
            getUserAgent();
            getBrowserAndOSInfo();
            getBatteryInfo();
            getScreenResolution();

            updateDeviceTimeAndLanguage();
            setInterval(updateDeviceTimeAndLanguage, 1000);

            const infoCards = document.querySelectorAll('.info-card');
            infoCards.forEach(card => {
                card.addEventListener('click', copyCardInfo);
            });
        });
    </script>
</body>
</html>
