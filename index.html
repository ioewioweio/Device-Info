<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Информация о вас</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 600px;
            width: 100%;
        }
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.5em;
        }
        p {
            font-size: 1.1em;
            color: #555;
            margin-bottom: 5px;
        }
        .info-value {
            font-size: 1.3em;
            color: #007bff;
            font-weight: bold;
            display: block;
            margin-bottom: 15px;
            word-wrap: break-word;
        }
        .loading {
            color: #888;
        }
        .warning {
            color: orange;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ваш IP-адрес (IPv4):</h1>
        <span id="ipv4-address" class="info-value loading">Загрузка...</span>

        <h1>Ваш IP-адрес (IPv6):</h1>
        <span id="ipv6-address" class="info-value loading">Загрузка... (не всегда доступен)</span>

        <h1>Страна и Город:</h1>
        <span id="location-info" class="info-value loading">Загрузка...</span>

        <h1>DNS:</h1>
        <span id="dns-info" class="info-value loading warning">Информация о DNS недоступна с клиента.</span>

        <h1>Поддержка WebRTC:</h1>
        <span id="webrtc-support" class="info-value loading">Проверка...</span>

        <h1>Обнаруженные IP-адреса через WebRTC:</h1>
        <span id="webrtc-leak" class="info-value loading">Проверка... (может раскрывать локальные IP или IP через VPN)</span>

        <h1>User-Agent:</h1>
        <span id="user-agent" class="info-value loading">Загрузка...</span>

        <h1>Браузер:</h1>
        <span id="browser-info" class="info-value loading">Загрузка...</span>

        <h1>Операционная система:</h1>
        <span id="os-info" class="info-value loading">Загрузка...</span>

        <h1>Батарея:</h1>
        <span id="battery-info" class="info-value loading">Загрузка... (может быть недоступно)</span>

        <h1>Разрешение экрана:</h1>
        <span id="screen-resolution" class="info-value loading">Загрузка...</span>

        <h1>Время устройства:</h1>
        <span id="device-time" class="info-value loading">Загрузка...</span>

        <h1>Язык устройства:</h1>
        <span id="device-language" class="info-value loading">Загрузка...</span>

        <h1>Язык браузера:</h1>
        <span id="browser-language" class="info-value loading">Загрузка...</span>
    </div>

    <script>
        // Функция для проверки, является ли строка действительным IP-адресом
        function isValidIpAddress(ip) {
            // Проверка на IPv4
            if (/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(ip)) {
                return true;
            }
            // Проверка на IPv6 (более сложная, но базовая)
            if (/^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/.test(ip) || /^((?:[0-9A-Fa-f]{1,4}(?::[0-9A-Fa-f]{1,4})*)?)::((?:[0-9A-Fa-f]{1,4}(?::[0-9A-Fa-f]{1,4})*)?)$/.test(ip)) {
                return true;
            }
            return false;
        }

        // --- IP-адреса и местоположение ---
        async function getIpAndLocation() {
            try {
                const ipv4Response = await fetch('http://ip-api.com/json');
                const ipv4Data = await ipv4Response.json();

                if (ipv4Data.status === 'success') {
                    document.getElementById('ipv4-address').textContent = ipv4Data.query;
                    document.getElementById('location-info').textContent = `${ipv4Data.country}, ${ipv4Data.city}`;
                } else {
                    document.getElementById('ipv4-address').textContent = 'Не удалось получить IPv4.';
                    document.getElementById('location-info').textContent = 'Не удалось получить местоположение.';
                    console.error('Ошибка IP-API (IPv4):', ipv4Data.message);
                }

                const ipv6Response = await fetch('https://api64.ipify.org?format=json');
                const ipv6Data = await ipv6Response.json();
                if (ipv6Data.ip) {
                    document.getElementById('ipv6-address').textContent = ipv6Data.ip;
                } else {
                    document.getElementById('ipv6-address').textContent = 'IPv6 не обнаружен или API недоступен.';
                }

            } catch (error) {
                console.error('Ошибка при получении IP/местоположения:', error);
                document.getElementById('ipv4-address').textContent = 'Ошибка сети при получении IPv4.';
                document.getElementById('location-info').textContent = 'Ошибка сети при получении местоположения.';
                document.getElementById('ipv6-address').textContent = 'Ошибка сети при получении IPv6.';
                document.getElementById('ipv4-address').classList.add('error');
                document.getElementById('location-info').classList.add('error');
                document.getElementById('ipv6-address').classList.add('error');
            } finally {
                document.getElementById('ipv4-address').classList.remove('loading');
                document.getElementById('ipv6-address').classList.remove('loading');
                document.getElementById('location-info').classList.remove('loading');
            }
        }

        // --- DNS (клиенту недоступно) ---
        function getDnsInfo() {
            document.getElementById('dns-info').classList.remove('loading');
        }

        // --- WebRTC ---
        async function getWebRTCInfo() {
            const webrtcSupportElement = document.getElementById('webrtc-support');
            const webrtcLeakElement = document.getElementById('webrtc-leak');

            if (typeof RTCPeerConnection === 'undefined') {
                webrtcSupportElement.textContent = 'WebRTC не поддерживается.';
                webrtcSupportElement.classList.add('error');
                webrtcLeakElement.textContent = 'N/A';
                webrtcLeakElement.classList.add('error');
                webrtcSupportElement.classList.remove('loading');
                webrtcLeakElement.classList.remove('loading');
                return;
            }

            webrtcSupportElement.textContent = 'Поддерживается.';
            webrtcSupportElement.classList.remove('loading');

            try {
                const pc = new RTCPeerConnection({ iceServers: [] });
                const candidates = [];

                pc.onicecandidate = function(event) {
                    if (event.candidate) {
                        const candidateString = event.candidate.candidate;
                        const parts = candidateString.split(' ');
                        const ipAddress = parts[4];
                        const candidateType = parts[7];

                        if (candidateType === 'host' && isValidIpAddress(ipAddress)) {
                            if (!candidates.includes(ipAddress)) {
                                candidates.push(ipAddress);
                            }
                        }
                    } else {
                        const ipList = candidates.length > 0 ? candidates.join(', ') : 'Не обнаружено (или заблокировано).';
                        webrtcLeakElement.textContent = ipList;
                        webrtcLeakElement.classList.remove('loading');
                        if (candidates.length > 0) {
                             webrtcLeakElement.classList.add('warning');
                        }
                    }
                };

                pc.createDataChannel('');
                await pc.createOffer().then(offer => pc.setLocalDescription(offer));

            } catch (error) {
                console.error('Ошибка WebRTC утечки:', error);
                webrtcLeakElement.textContent = 'Ошибка при проверке WebRTC утечки.';
                webrtcLeakElement.classList.add('error');
                webrtcLeakElement.classList.remove('loading');
            }
        }

        // --- User-Agent ---
        function getUserAgent() {
            const userAgentElement = document.getElementById('user-agent');
            userAgentElement.textContent = navigator.userAgent;
            userAgentElement.classList.remove('loading');
        }

        // --- Браузер и ОС ---
        async function getBrowserAndOSInfo() {
            const browserInfoElement = document.getElementById('browser-info');
            const osInfoElement = document.getElementById('os-info');
            let browserName = "Неизвестен";
            let browserVersion = "Неизвестна";
            let osName = "Неизвестна";
            let osVersion = "";

            if (navigator.userAgentData) {
                try {
                    const uaData = await navigator.userAgentData.getHighEntropyValues(["fullVersionList", "platform", "platformVersion"]);
                    const brands = uaData.fullVersionList || uaData.brands;

                    if (brands && brands.length > 0) {
                        for (const brand of brands) {
                            if (!brand.brand.includes("Not")) {
                                browserName = brand.brand;
                                browserVersion = brand.version;
                                break;
                            }
                        }
                    }

                    osName = uaData.platform || "Неизвестна";
                    osVersion = uaData.platformVersion ? ` ${uaData.platformVersion}` : "";

                } catch (error) {
                    console.error('Ошибка Client Hints:', error);
                    getBrowserAndOSInfoLegacy(browserInfoElement, osInfoElement);
                }
            } else {
                getBrowserAndOSInfoLegacy(browserInfoElement, osInfoElement);
            }

            browserInfoElement.textContent = `${browserName} (Версия: ${browserVersion})`;
            osInfoElement.textContent = `${osName}${osVersion}`;
            browserInfoElement.classList.remove('loading');
            osInfoElement.classList.remove('loading');
        }

        function getBrowserAndOSInfoLegacy(browserElement, osElement) {
            const userAgent = navigator.userAgent;
            let browserName = "Неизвестен (старый метод)";
            let browserVersion = "Неизвестна";
            let osName = "Неизвестна (старый метод)";
            let osVersion = "";

            if (userAgent.includes("Opera") || userAgent.includes("Opr")) {
                browserName = "Opera";
                browserVersion = userAgent.match(/(Opera|Opr)\/([0-9.]+)/)?.[2] || "Неизвестна";
            } else if (userAgent.includes("Edg")) {
                browserName = "Microsoft Edge";
                browserVersion = userAgent.match(/Edg\/([0-9.]+)/)?.[1] || "Неизвестна";
            } else if (userAgent.includes("Chrome")) {
                browserName = "Google Chrome";
                browserVersion = userAgent.match(/Chrome\/([0-9.]+)/)?.[1] || "Неизвестна";
            } else if (userAgent.includes("Safari")) {
                browserName = "Apple Safari";
                browserVersion = userAgent.match(/Version\/([0-9.]+).*Safari/)?.[1] || "Неизвестна";
            } else if (userAgent.includes("Firefox")) {
                browserName = "Mozilla Firefox";
                browserVersion = userAgent.match(/Firefox\/([0-9.]+)/)?.[1] || "Неизвестна";
            } else if (userAgent.includes("MSIE") || userAgent.includes("Trident")) {
                browserName = "Internet Explorer";
                browserVersion = userAgent.match(/(MSIE |rv:)([0-9.]+)/)?.[2] || "Неизвестна";
            }

            if (userAgent.includes("Windows NT 10.0")) { osName = "Windows"; osVersion = "10/11"; }
            else if (userAgent.includes("Windows NT 6.3")) { osName = "Windows"; osVersion = "8.1"; }
            else if (userAgent.includes("Windows NT 6.2")) { osName = "Windows"; osVersion = "8"; }
            else if (userAgent.includes("Windows NT 6.1")) { osName = "Windows"; osVersion = "7"; }
            else if (userAgent.includes("Mac OS X")) { osName = "macOS"; osVersion = userAgent.match(/Mac OS X ([0-9_.]+)/)?.[1]?.replace(/_/g, '.') || ""; }
            else if (userAgent.includes("Android")) { osName = "Android"; osVersion = userAgent.match(/Android ([0-9.]+)/)?.[1] || ""; }
            else if (userAgent.includes("Linux")) { osName = "Linux"; }
            else if (userAgent.includes("iOS")) { osName = "iOS"; osVersion = userAgent.match(/OS ([0-9_.]+)/)?.[1]?.replace(/_/g, '.') || ""; }
            else if (navigator.platform.includes("Win")) { osName = "Windows"; }
            else if (navigator.platform.includes("Mac")) { osName = "macOS"; }
            else if (navigator.platform.includes("Linux")) { osName = "Linux"; }
            else if (navigator.platform.includes("iPhone") || navigator.platform.includes("iPad") || navigator.platform.includes("iPod")) { osName = "iOS"; }

            browserElement.textContent = `${browserName} (Версия: ${browserVersion})`;
            osElement.textContent = `${osName}${osVersion ? ' ' + osVersion : ''}`;
        }

        // --- Батарея ---
        async function getBatteryInfo() {
            const batteryInfoElement = document.getElementById('battery-info');
            if ('getBattery' in navigator) {
                try {
                    const battery = await navigator.getBattery();
                    const level = (battery.level * 100).toFixed(0);
                    const charging = battery.charging ? ' (Заряжается)' : ' (Не заряжается)';
                    batteryInfoElement.textContent = `${level}%${charging}`;
                } catch (error) {
                    console.error('Ошибка при получении информации о батарее:', error);
                    batteryInfoElement.textContent = 'Ошибка получения батареи.';
                    batteryInfoElement.classList.add('error');
                }
            } else {
                batteryInfoElement.textContent = 'API Батареи недоступен.';
                batteryInfoElement.classList.add('warning');
            }
            batteryInfoElement.classList.remove('loading');
        }

        // --- Разрешение экрана ---
        function getScreenResolution() {
            const screenResolutionElement = document.getElementById('screen-resolution');
            screenResolutionElement.textContent = `${screen.width}x${screen.height} пикселей`;
            screenResolutionElement.classList.remove('loading');
        }

        // --- Время и язык устройства/браузера ---
        function updateDeviceTimeAndLanguage() { // Переименована для ясности
            const deviceTimeElement = document.getElementById('device-time');
            const deviceLanguageElement = document.getElementById('device-language');
            const browserLanguageElement = document.getElementById('browser-language');

            const now = new Date();
            deviceTimeElement.textContent = now.toLocaleString();
            deviceTimeElement.classList.remove('loading');

            deviceLanguageElement.textContent = (navigator.languages && navigator.languages.length > 0) ? navigator.languages.join(', ') : 'Неизвестен';
            deviceLanguageElement.classList.remove('loading');

            browserLanguageElement.textContent = navigator.language || 'Неизвестен';
            browserLanguageElement.classList.remove('loading');
        }


        // --- Вызов всех функций ---
        getIpAndLocation();
        getDnsInfo();
        getWebRTCInfo();
        getUserAgent();
        getBrowserAndOSInfo();
        getBatteryInfo();
        getScreenResolution();

        // Динамическое обновление времени каждую секунду
        updateDeviceTimeAndLanguage(); // Вызываем сразу для первоначального отображения
        setInterval(updateDeviceTimeAndLanguage, 1000); // Обновляем каждую секунду
    </script>
</body>
</html>
